{"version":3,"sources":["../src/helpers/SnapSmartContractAccount.ts"],"sourcesContent":["import { ADDRESS_ZERO, EMPTY_BYTES, VALUE_ZERO } from '../constants';\nimport type {\n  PrepareUserOperationRequest,\n  PrepareUserOperationResponse,\n  SignUserOperationRequest,\n  SignUserOperationResponse,\n  SmartContractAccount,\n  UpdateUserOperationRequest,\n  UpdateUserOperationResponse,\n} from '../types';\nimport type { UserOperationControllerMessenger } from '../UserOperationController';\n\nexport class SnapSmartContractAccount implements SmartContractAccount {\n  #messenger: UserOperationControllerMessenger;\n\n  constructor(messenger: UserOperationControllerMessenger) {\n    this.#messenger = messenger;\n  }\n\n  async prepareUserOperation(\n    request: PrepareUserOperationRequest,\n  ): Promise<PrepareUserOperationResponse> {\n    const {\n      data: requestData,\n      from: sender,\n      to: requestTo,\n      value: requestValue,\n    } = request;\n\n    const data = requestData ?? EMPTY_BYTES;\n    const to = requestTo ?? ADDRESS_ZERO;\n    const value = requestValue ?? VALUE_ZERO;\n\n    const response = await this.#messenger.call(\n      'KeyringController:prepareUserOperation',\n      sender,\n      [{ data, to, value }],\n    );\n\n    const {\n      bundlerUrl: bundler,\n      callData,\n      dummyPaymasterAndData,\n      dummySignature,\n      gasLimits: gas,\n      initCode,\n      nonce,\n    } = response;\n\n    return {\n      bundler,\n      callData,\n      dummyPaymasterAndData,\n      dummySignature,\n      gas,\n      initCode,\n      nonce,\n      sender,\n    };\n  }\n\n  async updateUserOperation(\n    request: UpdateUserOperationRequest,\n  ): Promise<UpdateUserOperationResponse> {\n    const { userOperation } = request;\n    const { sender } = userOperation;\n\n    const { paymasterAndData: responsePaymasterAndData } =\n      await this.#messenger.call(\n        'KeyringController:patchUserOperation',\n        sender,\n        userOperation,\n      );\n\n    const paymasterAndData =\n      responsePaymasterAndData === EMPTY_BYTES\n        ? undefined\n        : responsePaymasterAndData;\n\n    return {\n      paymasterAndData,\n    };\n  }\n\n  async signUserOperation(\n    request: SignUserOperationRequest,\n  ): Promise<SignUserOperationResponse> {\n    const { userOperation } = request;\n    const { sender } = userOperation;\n\n    const signature = await this.#messenger.call(\n      'KeyringController:signUserOperation',\n      sender,\n      userOperation,\n    );\n\n    return { signature };\n  }\n}\n"],"mappings":";;;;;;;;;;;;AAAA;AAYO,IAAM,2BAAN,MAA+D;AAAA,EAGpE,YAAY,WAA6C;AAFzD;AAGE,uBAAK,YAAa;AAAA,EACpB;AAAA,EAEA,MAAM,qBACJ,SACuC;AACvC,UAAM;AAAA,MACJ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,IAAI;AAAA,MACJ,OAAO;AAAA,IACT,IAAI;AAEJ,UAAM,OAAO,eAAe;AAC5B,UAAM,KAAK,aAAa;AACxB,UAAM,QAAQ,gBAAgB;AAE9B,UAAM,WAAW,MAAM,mBAAK,YAAW;AAAA,MACrC;AAAA,MACA;AAAA,MACA,CAAC,EAAE,MAAM,IAAI,MAAM,CAAC;AAAA,IACtB;AAEA,UAAM;AAAA,MACJ,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,MACA;AAAA,MACA,WAAW;AAAA,MACX;AAAA,MACA;AAAA,IACF,IAAI;AAEJ,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,oBACJ,SACsC;AACtC,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,EAAE,OAAO,IAAI;AAEnB,UAAM,EAAE,kBAAkB,yBAAyB,IACjD,MAAM,mBAAK,YAAW;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAEF,UAAM,mBACJ,6BAA6B,cACzB,SACA;AAEN,WAAO;AAAA,MACL;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,kBACJ,SACoC;AACpC,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,EAAE,OAAO,IAAI;AAEnB,UAAM,YAAY,MAAM,mBAAK,YAAW;AAAA,MACtC;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAEA,WAAO,EAAE,UAAU;AAAA,EACrB;AACF;AArFE;","names":[]}