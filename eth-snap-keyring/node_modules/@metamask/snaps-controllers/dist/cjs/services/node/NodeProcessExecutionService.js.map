{"version":3,"sources":["../../../../src/services/node/NodeProcessExecutionService.ts"],"sourcesContent":["import type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { ProcessParentMessageStream } from '@metamask/post-message-stream';\nimport type { ChildProcess } from 'child_process';\nimport { fork } from 'child_process';\n\nimport type { Job } from '..';\nimport { AbstractExecutionService } from '..';\n\nexport class NodeProcessExecutionService extends AbstractExecutionService<ChildProcess> {\n  protected async initEnvStream(): Promise<{\n    worker: ChildProcess;\n    stream: BasePostMessageStream;\n  }> {\n    const worker = fork(\n      require.resolve(\n        '@metamask/snaps-execution-environments/dist/browserify/node-process/bundle.js',\n      ),\n      {\n        stdio: 'pipe',\n      },\n    );\n\n    // Capturing `stdout` and `stderr` from the worker prevents the worker from\n    // writing to them directly, making it easier to capture them Jest.\n    worker.stdout?.on('data', (data) => {\n      // eslint-disable-next-line no-console\n      console.log(data.toString());\n    });\n\n    worker.stderr?.on('data', (data) => {\n      // eslint-disable-next-line no-console\n      console.error(data.toString());\n    });\n\n    const stream = new ProcessParentMessageStream({ process: worker });\n    return Promise.resolve({ worker, stream });\n  }\n\n  protected terminateJob(jobWrapper: Job<ChildProcess>): void {\n    jobWrapper.worker.kill();\n  }\n}\n"],"names":["NodeProcessExecutionService","AbstractExecutionService","initEnvStream","worker","fork","require","resolve","stdio","stdout","on","data","console","log","toString","stderr","error","stream","ProcessParentMessageStream","process","Promise","terminateJob","jobWrapper","kill"],"mappings":";;;;+BAQaA;;;eAAAA;;;mCAP8B;+BAEtB;kBAGoB;AAElC,MAAMA,oCAAoCC,0BAAwB;IACvE,MAAgBC,gBAGb;QACD,MAAMC,SAASC,IAAAA,mBAAI,EACjBC,QAAQC,OAAO,CACb,kFAEF;YACEC,OAAO;QACT;QAGF,2EAA2E;QAC3E,mEAAmE;QACnEJ,OAAOK,MAAM,EAAEC,GAAG,QAAQ,CAACC;YACzB,sCAAsC;YACtCC,QAAQC,GAAG,CAACF,KAAKG,QAAQ;QAC3B;QAEAV,OAAOW,MAAM,EAAEL,GAAG,QAAQ,CAACC;YACzB,sCAAsC;YACtCC,QAAQI,KAAK,CAACL,KAAKG,QAAQ;QAC7B;QAEA,MAAMG,SAAS,IAAIC,6CAA0B,CAAC;YAAEC,SAASf;QAAO;QAChE,OAAOgB,QAAQb,OAAO,CAAC;YAAEH;YAAQa;QAAO;IAC1C;IAEUI,aAAaC,UAA6B,EAAQ;QAC1DA,WAAWlB,MAAM,CAACmB,IAAI;IACxB;AACF"}