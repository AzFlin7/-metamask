{"version":3,"sources":["../../../../src/services/node/NodeProcessExecutionService.ts"],"sourcesContent":["import type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { ProcessParentMessageStream } from '@metamask/post-message-stream';\nimport type { ChildProcess } from 'child_process';\nimport { fork } from 'child_process';\n\nimport type { Job } from '..';\nimport { AbstractExecutionService } from '..';\n\nexport class NodeProcessExecutionService extends AbstractExecutionService<ChildProcess> {\n  protected async initEnvStream(): Promise<{\n    worker: ChildProcess;\n    stream: BasePostMessageStream;\n  }> {\n    const worker = fork(\n      require.resolve(\n        '@metamask/snaps-execution-environments/dist/browserify/node-process/bundle.js',\n      ),\n      {\n        stdio: 'pipe',\n      },\n    );\n\n    // Capturing `stdout` and `stderr` from the worker prevents the worker from\n    // writing to them directly, making it easier to capture them Jest.\n    worker.stdout?.on('data', (data) => {\n      // eslint-disable-next-line no-console\n      console.log(data.toString());\n    });\n\n    worker.stderr?.on('data', (data) => {\n      // eslint-disable-next-line no-console\n      console.error(data.toString());\n    });\n\n    const stream = new ProcessParentMessageStream({ process: worker });\n    return Promise.resolve({ worker, stream });\n  }\n\n  protected terminateJob(jobWrapper: Job<ChildProcess>): void {\n    jobWrapper.worker.kill();\n  }\n}\n"],"names":["ProcessParentMessageStream","fork","AbstractExecutionService","NodeProcessExecutionService","initEnvStream","worker","require","resolve","stdio","stdout","on","data","console","log","toString","stderr","error","stream","process","Promise","terminateJob","jobWrapper","kill"],"mappings":"AACA,SAASA,0BAA0B,QAAQ,gCAAgC;AAE3E,SAASC,IAAI,QAAQ,gBAAgB;AAGrC,SAASC,wBAAwB,QAAQ,KAAK;AAE9C,OAAO,MAAMC,oCAAoCD;IAC/C,MAAgBE,gBAGb;QACD,MAAMC,SAASJ,KACbK,QAAQC,OAAO,CACb,kFAEF;YACEC,OAAO;QACT;QAGF,2EAA2E;QAC3E,mEAAmE;QACnEH,OAAOI,MAAM,EAAEC,GAAG,QAAQ,CAACC;YACzB,sCAAsC;YACtCC,QAAQC,GAAG,CAACF,KAAKG,QAAQ;QAC3B;QAEAT,OAAOU,MAAM,EAAEL,GAAG,QAAQ,CAACC;YACzB,sCAAsC;YACtCC,QAAQI,KAAK,CAACL,KAAKG,QAAQ;QAC7B;QAEA,MAAMG,SAAS,IAAIjB,2BAA2B;YAAEkB,SAASb;QAAO;QAChE,OAAOc,QAAQZ,OAAO,CAAC;YAAEF;YAAQY;QAAO;IAC1C;IAEUG,aAAaC,UAA6B,EAAQ;QAC1DA,WAAWhB,MAAM,CAACiB,IAAI;IACxB;AACF"}